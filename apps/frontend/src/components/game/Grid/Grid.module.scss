@use 'sass:math';
@use '../../../styles/tokens/variables' as *;

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 100%;
}



.gridWrapper {
  position: relative;
  width: 210px; 
  height: 210px; 
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto;
  perspective: 1000px; // Enable 3D space
  transition: transform var(--duration-normal), opacity var(--duration-normal);

  &.active {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
  }

  &.inactive {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
    pointer-events: none;
    position: absolute; // Remove from flow when inactive to overlay
  }
}

.grid {
  display: grid;
  grid-template-columns: repeat(6, 32px); // 6x6 Visuals
  grid-template-rows: repeat(6, 32px);
  gap: 1px;
  position: relative;
  transition: all var(--duration-normal);

  // BASE THEME (Default / Placement)
  background-color: var(--color-bg-deep);
  border: 2px solid var(--color-primary); // Restored and thickened
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);

  // FRIENDLY THEME (Defense)
  &.friendly {
    border-color: var(--color-friendly-accent);
    box-shadow: 0 0 20px rgba(34, 211, 238, 0.15);

    // Grid lines color mix
    background-color: color-mix(in srgb, var(--color-friendly-bg), var(--color-friendly-accent) 5%);
  }

  // ENEMY THEME (Attack)
  &.enemy {
    border-color: var(--color-enemy-accent);
    box-shadow: 0 0 20px rgba(245, 158, 11, 0.15);
    
    // Grid lines color mix
    background-color: color-mix(in srgb, var(--color-enemy-bg), var(--color-enemy-accent) 5%);
  }
}

.shipLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
}

.ghostLayer {
  @extend .shipLayer;
  z-index: 20;
}

.ship {
  position: absolute;
  transition: all 0.2s ease-out;
  pointer-events: none;
}

.mine {
  position: absolute;
  width: 32px;
  height: 32px;
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: none;
  z-index: 10;
  font-size: 20px;
}

.ghostParams {
  position: absolute;
  opacity: 0.6;
  pointer-events: none;
  transition: top 0.1s linear, left 0.1s linear;

  &--valid {
    filter: drop-shadow(0 0 4px var(--color-success));
    
    :global(svg) {
        path, rect {
             fill: color-mix(in srgb, var(--color-success), transparent 70%) !important;
             stroke: color-mix(in srgb, var(--color-success), transparent 20%) !important;
        }
    }
  }

  &--invalid {
    filter: drop-shadow(0 0 4px var(--color-danger));

     :global(svg) {
        path, rect {
             fill: color-mix(in srgb, var(--color-danger), transparent 70%) !important;
             stroke: color-mix(in srgb, var(--color-danger), transparent 20%) !important;
        }
    }
  }
}



// Overlay Markers
.cellHitOverlay {
  // Replicating .cell--hit from Cell.module.scss
  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60%;
    height: 60%;
    background: var(--color-accent-orange);
    border-radius: 50%;
    box-shadow: 0 0 10px var(--color-accent-orange);
    animation: pulse 1.5s infinite;
  }
}

.cellMissOverlay {
  // Replicating .cell--miss from Cell.module.scss
  &::before, &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 60%;
    height: 2px;
    background: color-mix(in srgb, var(--color-danger), transparent 30%); // More opaque for visibility over ships
  }
  &::before { transform: translate(-50%, -50%) rotate(45deg); }
  &::after { transform: translate(-50%, -50%) rotate(-45deg); }
}

.cellMineOverlay {
    &::after {
      content: 'ðŸ’£'; 
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.2rem;
    }
}

.cellSunkOverlay {
  // Replicating .cell--hit STRUCTURE from Cell.module.scss but RED
  // This ensures the "square" look (background/border) matches the Hit cell.
  
  background: color-mix(in srgb, var(--color-danger), transparent 50%); // Slightly more opaque than hit to show severity
  box-shadow: inset 0 0 15px color-mix(in srgb, var(--color-danger), transparent 60%);
  border: 1px solid var(--color-danger); // Explicit border
  
  // The Circle
  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60%;
    height: 60%;
    background: var(--color-danger); // Solid Red
    border-radius: 50%;
    box-shadow: 0 0 15px var(--color-danger);
    z-index: 5;
    animation: pulse 2s infinite;
  }
}

@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.8; }
  50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.8; }
}
